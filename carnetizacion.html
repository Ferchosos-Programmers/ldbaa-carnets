<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Carnetizaci√≥n | Liga Barrial</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- SweetAlert2 -->

    <!-- Firebase SDK sin m√≥dulos -->
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-firestore.js"></script>

    <link rel="stylesheet" href="css/responsive.css" />
    <link rel="stylesheet" href="css/carnetizacion.css" />
  </head>
  <body>
    <!-- Header -->
    <nav
      class="navbar navbar-expand-lg shadow-sm px-4"
      style="background-color: #28a745"
    >
      <div class="container-fluid">
        <a
          class="navbar-brand text-white fw-bold d-flex align-items-center"
          href="#"
        >
          <img
            src="img/logo.png"
            alt="Logo"
            width="30"
            height="30"
            class="me-2"
          />
          LIGA BARRIAL ARGELIA ALTA
        </a>
        <button
          class="btn btn-outline-light"
          onclick="window.location.href='index.html'"
        >
          <i class="fas fa-arrow-left me-2"></i>Regresar
        </button>
      </div>
    </nav>

    <div class="container mt-4">
      <h3 class="text-dark">üèÜ Equipos Registrados</h3>

      <!-- Filtros de b√∫squeda -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="input-group shadow-sm">
            <span class="input-group-text bg-white"
              ><i class="fas fa-search text-muted"></i
            ></span>
            <input
              type="text"
              id="searchInput"
              class="form-control"
              placeholder="Buscar por nombre del equipo..."
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="input-group shadow-sm">
            <span class="input-group-text bg-white"
              ><i class="fas fa-filter text-muted"></i
            ></span>
            <select id="categoryFilter" class="form-select">
              <option value="">Todas las categor√≠as</option>
              <option value="M√ÅXIMA">M√ÅXIMA</option>
              <option value="PRIMERA">PRIMERA</option>
              <option value="FEMENINO">FEMENINO</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Contenedor de tarjetas -->
      <div class="row" id="teamCardsContainer">
        <!-- Se cargan din√°micamente -->
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const teamCardsContainer = document.getElementById("teamCardsContainer");
      const searchInput = document.getElementById("searchInput");
      const categoryFilter = document.getElementById("categoryFilter");
      let allTeams = [];

      // Inicializar Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyAzRTlx96sL8rxcgLauftrTWpr5VlwjV00",
        authDomain: "ldbaa-calificaciones.firebaseapp.com",
        projectId: "ldbaa-calificaciones",
        storageBucket: "ldbaa-calificaciones.firebasestorage.app",
        messagingSenderId: "277579489603",
        appId: "1:277579489603:web:bc93c22fea5f5f6b63cff6",
      };

      try {
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        db.settings({
          cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED,
        });

        // Mostrar cuenta regresiva y luego cargar equipos
        mostrarCuentaRegresiva().then(() => {
          loadTeams();
        });

        searchInput.addEventListener("input", filterTeams);
        categoryFilter.addEventListener("change", filterTeams);

        <!-- Dentro de tu archivo HTML, reemplaza el bloque mostrarCuentaRegresiva() por este -->

        function mostrarCuentaRegresiva() {
          return new Promise((resolve) => {
            const deadline = new Date("2025-05-10T23:59:59").getTime();
            const countdownDiv = document.createElement("div");
            countdownDiv.style.fontSize = "1rem";
            countdownDiv.style.fontWeight = "normal";
            countdownDiv.style.textAlign = "center";
            countdownDiv.style.color = "#333";

            const interval = setInterval(() => {
              const now = new Date().getTime();
              const distance = deadline - now;

              if (distance < 0) {
                clearInterval(interval);
                countdownDiv.innerHTML = "‚è∞ ¬°La fecha l√≠mite ha pasado!";
                return;
              }

              const days = Math.floor(distance / (1000 * 60 * 60 * 24));
              const hours = Math.floor(
                (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
              );
              const minutes = Math.floor(
                (distance % (1000 * 60 * 60)) / (1000 * 60)
              );
              const seconds = Math.floor((distance % (1000 * 60)) / 1000);

              countdownDiv.innerHTML = `
        <div style="font-size: 1.1rem; margin-top: -2px;">
          ‚è≥ Tienes hasta el <strong>10 de mayo</strong> para completar la carnetizaci√≥n.
        </div>
        <div style="margin-top: 8px; font-weight: bold; font-size: 1.2rem;">
          Tiempo restante: <span style="color: #28a745;">${days}d ${hours}h ${minutes}m ${seconds}s</span>
        </div>
      `;
            }, 1000);

            Swal.fire({
              title:
                '<img src="img/logo.png" alt="Logo" width="60" style="margin-bottom: 5px;"><br><span style="font-size: 1.4rem;">Aviso Importante</span>',
              html: countdownDiv,
              confirmButtonText: "Entendido",
              allowOutsideClick: false,
              showCloseButton: true,
              customClass: {
                confirmButton: "btn btn-success px-4",
                popup: "shadow-lg rounded",
                title: "mb-3",
              },
              buttonsStyling: false,
              didOpen: () => {
                Swal.getContent().appendChild(countdownDiv);
              },
            }).then(() => {
              clearInterval(interval);
              resolve();
            });
          });
        }

        function loadTeams() {
          db.collection("teams")
            .get()
            .then((querySnapshot) => {
              teamCardsContainer.innerHTML = "";
              allTeams = [];

              if (querySnapshot.empty) {
                teamCardsContainer.innerHTML =
                  '<div class="col-12 text-center"><p>No hay equipos registrados</p></div>';
              } else {
                querySnapshot.forEach((doc) => {
                  const teamData = doc.data();
                  teamData.id = doc.id;
                  allTeams.push(teamData);
                });
                displayTeams(allTeams);
              }
            })
            .catch((error) => {
              console.error("Error al cargar equipos:", error);
              Swal.fire(
                "Error",
                "No se pudieron cargar los equipos. Por favor, intenta de nuevo.",
                "error"
              );
            });
        }

        function filterTeams() {
          const searchTerm = searchInput.value.toLowerCase();
          const selectedCategory = categoryFilter.value;

          const filteredTeams = allTeams.filter((team) => {
            const nameMatch = team.name.toLowerCase().includes(searchTerm);
            const categoryMatch =
              selectedCategory === "" || team.category === selectedCategory;
            return nameMatch && categoryMatch;
          });

          displayTeams(filteredTeams);
        }

        function displayTeams(teams) {
          teamCardsContainer.innerHTML = "";
          if (teams.length === 0) {
            teamCardsContainer.innerHTML =
              '<div class="col-12 text-center"><p>No se encontraron equipos que coincidan con los filtros</p></div>';
          } else {
            teams.forEach((team) => {
              createTeamCard(team);
            });
          }
        }

        function createTeamCard(team) {
          const card = document.createElement("div");
          card.className = "col-md-4 mb-4";
          card.innerHTML = `
            <div class="card shadow-sm border-0 h-100">
              <img src="${team.logo}" class="card-img-top p-3" alt="Logo del equipo" style="height: 200px; object-fit: contain;">
              <div class="card-body text-center">
                <h5 class="card-title">${team.name}</h5>
                <p class="card-text"><strong>Categor√≠a:</strong> ${team.category}</p>
                <button class="btn btn-success btn-sm" onclick="entrarEquipo('${team.id}', '${team.name}')">Entrar</button>
              </div>
            </div>
          `;
          teamCardsContainer.appendChild(card);
        }

        window.entrarEquipo = function (teamId, teamName) {
          Swal.fire({
            title: "¬øEntrar al equipo?",
            text: `¬øDeseas entrar al equipo ${teamName}?`,
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#28a745",
            cancelButtonColor: "#d33",
            confirmButtonText: "S√≠, entrar",
            cancelButtonText: "Cancelar",
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = `registro-jugador.html?teamId=${teamId}`;
            }
          });
        };
      } catch (error) {
        console.error("Error al inicializar Firebase:", error);
        Swal.fire(
          "Error",
          "No se pudo inicializar la aplicaci√≥n. Por favor, recarga la p√°gina.",
          "error"
        );
      }
    </script>
  </body>
</html>
